language: php

php:
  - "7.0"

before_script:
  - composer install

build:
  ci:
    - ls
    - ls vendor/bin
    - pwd -P
    - cat composer.json
    - ./vendor/bin/phpunit
    - phpunit --log-junit shippable/testresults/junit.xml --coverage-xml shippable/codecoverage
  post_ci:
    - docker build -t 824574892225.dkr.ecr.eu-west-2.amazonaws.com/wordpress:$BRANCH.$BUILD_NUMBER .
  push:
    - docker push 824574892225.dkr.ecr.eu-west-2.amazonaws.com/wordpress:$BRANCH.$BUILD_NUMBER

notifications:
  email: false   

integrations:
  hub:
    - integrationName: amazon_ecr
      region: eu-west-2              
      type: ecr